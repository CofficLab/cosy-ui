# 步骤 02.1：服务容器类型定义

## 目标
定义服务容器所需的所有类型接口，为后续实现提供类型安全保证。

## 任务清单
- [ ] 定义容器接口
- [ ] 定义服务提供者接口
- [ ] 定义装饰器类型
- [ ] 定义工具类型

## 执行步骤

### 1. 更新类型定义

**更新文件**: `src/types/container.ts`

```typescript
// 基础类型
export type Constructor<T = any> = new (...args: any[]) => T
export type Token = string | symbol | Constructor
export type Factory<T = any> = (...args: any[]) => T

// 服务定义
export interface ServiceDefinition<T = any> {
  token: Token
  factory: Factory<T>
  singleton?: boolean
  dependencies?: Token[]
}

// 容器接口
export interface ContainerInterface {
  // 绑定服务
  bind<T>(token: Token, implementation: Constructor<T>): this
  singleton<T>(token: Token, implementation: Constructor<T>): this
  factory<T>(token: Token, factory: Factory<T>): this
  
  // 解析服务
  resolve<T>(token: Token): T
  resolveAll<T>(tokens: Token[]): T[]
  
  // 服务管理
  has(token: Token): boolean
  remove(token: Token): boolean
  clear(): void
  
  // 服务提供者
  register(provider: ServiceProvider): this
  boot(): Promise<void>
  shutdown(): Promise<void>
}

// 服务提供者接口
export interface ServiceProvider {
  register(container: ContainerInterface): void
  boot?(): Promise<void>
  shutdown?(): Promise<void>
}

// 装饰器元数据
export interface InjectMetadata {
  token: Token
  optional?: boolean
}

export interface ServiceMetadata {
  token?: Token
  singleton?: boolean
  dependencies?: Token[]
}

// 工具类型
export type ServiceFactory<T> = (container: ContainerInterface) => T
export type ServiceResolver<T> = () => T
export type DependencyResolver = (token: Token) => any

// 错误类型
export class ServiceNotFoundError extends Error {
  constructor(token: Token) {
    super(`Service not found: ${String(token)}`)
  }
}

export class CircularDependencyError extends Error {
  constructor(tokens: Token[]) {
    super(`Circular dependency detected: ${tokens.map(String).join(' -> ')}`)
  }
}
```

## 类型说明

### 基础类型
- `Constructor`: 构造函数类型
- `Token`: 服务标识符类型
- `Factory`: 工厂函数类型

### 服务定义
- `ServiceDefinition`: 完整的服务定义
  - `token`: 服务标识符
  - `factory`: 服务工厂函数
  - `singleton`: 是否为单例
  - `dependencies`: 依赖项列表

### 容器接口
- `ContainerInterface`: 服务容器的主要接口
  - 服务绑定方法
  - 服务解析方法
  - 服务管理方法
  - 服务提供者方法

### 服务提供者
- `ServiceProvider`: 服务提供者接口
  - `register`: 注册服务
  - `boot`: 启动钩子（可选）
  - `shutdown`: 关闭钩子（可选）

### 装饰器元数据
- `InjectMetadata`: 注入装饰器元数据
- `ServiceMetadata`: 服务装饰器元数据

### 工具类型
- `ServiceFactory`: 服务工厂类型
- `ServiceResolver`: 服务解析器类型
- `DependencyResolver`: 依赖解析器类型

### 错误类型
- `ServiceNotFoundError`: 服务未找到错误
- `CircularDependencyError`: 循环依赖错误

## 完成标志
- [ ] 所有必要的类型已定义
- [ ] 类型定义完整且清晰
- [ ] TypeScript 类型检查无错误
- [ ] 接口文档注释完整

## 下一步
完成此步骤后，继续执行 `02.2-container-implementation.md`。 
