# 步骤 03.1：HTTP 类型定义

## 目标
定义 HTTP 基础设施所需的所有类型接口，为后续实现提供类型安全保证。

## 任务清单
- [ ] 定义请求接口
- [ ] 定义响应接口
- [ ] 定义上下文接口
- [ ] 定义文件上传类型
- [ ] 定义 Cookie 选项类型
- [ ] 定义 HTTP 状态码和方法枚举

## 执行步骤

### 1. 更新类型定义

**更新文件**: `src/types/index.ts`

```typescript
// HTTP 请求接口
export interface RequestInterface {
  method: string
  url: string
  path: string
  query: Record<string, any>
  params: Record<string, any>
  headers: Record<string, string>
  body: any
  cookies: Record<string, string>
  files: Record<string, FileUpload[]>
  ip: string
  userAgent: string
  
  // 方法
  get(key: string): any
  has(key: string): boolean
  input(key?: string, defaultValue?: any): any
  cookie(name: string, defaultValue?: string): string
  header(name: string, defaultValue?: string): string
  file(name: string): FileUpload | FileUpload[] | undefined
}

// HTTP 响应接口
export interface ResponseInterface {
  status(code: number): ResponseInterface
  json(data: any): ResponseInterface
  html(content: string): ResponseInterface
  redirect(url: string, status?: number): ResponseInterface
  cookie(name: string, value: string, options?: CookieOptions): ResponseInterface
  clearCookie(name: string): ResponseInterface
  header(name: string, value: string): ResponseInterface
  send(content?: any): ResponseInterface
  download(filePath: string, filename?: string): ResponseInterface
  attachment(filename?: string): ResponseInterface
}

// 文件上传类型
export interface FileUpload {
  fieldname: string
  originalname: string
  encoding: string
  mimetype: string
  size: number
  destination?: string
  filename?: string
  path?: string
  buffer?: Buffer
}

// Cookie 选项类型
export interface CookieOptions {
  maxAge?: number
  expires?: Date
  httpOnly?: boolean
  secure?: boolean
  sameSite?: 'strict' | 'lax' | 'none'
  domain?: string
  path?: string
}

// HTTP 上下文接口
export interface HttpContextInterface {
  request: RequestInterface
  response: ResponseInterface
}

// HTTP 状态码
export enum HttpStatus {
  OK = 200,
  CREATED = 201,
  ACCEPTED = 202,
  NO_CONTENT = 204,
  MOVED_PERMANENTLY = 301,
  FOUND = 302,
  NOT_MODIFIED = 304,
  BAD_REQUEST = 400,
  UNAUTHORIZED = 401,
  FORBIDDEN = 403,
  NOT_FOUND = 404,
  METHOD_NOT_ALLOWED = 405,
  CONFLICT = 409,
  UNPROCESSABLE_ENTITY = 422,
  INTERNAL_SERVER_ERROR = 500,
  NOT_IMPLEMENTED = 501,
  BAD_GATEWAY = 502,
  SERVICE_UNAVAILABLE = 503
}

// HTTP 方法
export enum HttpMethod {
  GET = 'GET',
  POST = 'POST',
  PUT = 'PUT',
  PATCH = 'PATCH',
  DELETE = 'DELETE',
  HEAD = 'HEAD',
  OPTIONS = 'OPTIONS'
}
```

## 类型说明

### RequestInterface
- 包含请求的基本属性（方法、URL、路径等）
- 提供访问请求数据的方法（查询参数、请求体、Cookie等）
- 支持文件上传处理

### ResponseInterface
- 提供链式调用API
- 支持多种响应类型（JSON、HTML等）
- 支持 Cookie 和头部管理
- 支持文件下载和附件

### FileUpload
- 描述上传文件的属性
- 包含文件元数据（名称、类型、大小等）
- 支持文件系统和内存存储

### CookieOptions
- 完整的 Cookie 配置选项
- 支持安全相关设置
- 支持过期和域设置

### HttpContextInterface
- 将请求和响应封装在一起
- 提供完整的请求处理上下文

### HttpStatus 和 HttpMethod
- 完整的 HTTP 状态码枚举
- 标准 HTTP 方法枚举

## 完成标志
- [ ] 所有必要的类型已定义
- [ ] 类型定义完整且清晰
- [ ] TypeScript 类型检查无错误
- [ ] 接口文档注释完整

## 下一步
完成此步骤后，继续执行 `03.2-http-request.md`。 
