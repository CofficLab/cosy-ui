---
/**
 * @component Footer
 * 
 * @description
 * Footer 组件用于创建网站的页脚部分，提供版权信息、导航链接和社交媒体链接等内容。
 * 该组件支持高度自定义，可以根据需要显示或隐藏不同的部分。
 * 
 * @design
 * 设计理念：
 * 1. 清晰的信息层次 - 通过视觉层次和分组展示不同类别的页脚信息
 * 2. 响应式布局 - 在不同屏幕尺寸下保持良好的可用性和美观性
 * 3. 可定制性 - 支持多种配置选项，适应不同网站的需求
 * 4. 品牌一致性 - 与网站整体设计风格保持一致
 * 5. 多语言支持 - 支持多种语言显示，自动检测当前语言环境
 * 
 * 视觉特点：
 * - 分区布局：清晰区分不同类别的信息
 * - 简洁设计：使用适当的间距和字体大小确保可读性
 * - 品牌展示：突出显示网站名称和标语
 * - 社交媒体整合：提供社交媒体链接的展示
 * 
 * @usage
 * 基本用法：
 * ```astro
 * <Footer 
 *   siteName="我的网站"
 *   homeLink="/"
 *   slogan="简单而强大"
 *   company="我的公司"
 *   copyright="保留所有权利"
 *   inspirationalSlogan="构建美好的数字体验"
 * />
 * ```
 * 
 * 添加社交媒体链接：
 * ```astro
 * <Footer 
 *   siteName="我的网站"
 *   homeLink="/"
 *   slogan="简单而强大"
 *   company="我的公司"
 *   copyright="保留所有权利"
 *   inspirationalSlogan="构建美好的数字体验"
 *   socialLinks={[
 *     "https://github.com/myusername",
 *     "https://twitter.com/myusername"
 *   ]}
 * />
 * ```
 * 
 * 添加产品链接：
 * ```astro
 * <Footer 
 *   siteName="我的网站"
 *   homeLink="/"
 *   slogan="简单而强大"
 *   company="我的公司"
 *   copyright="保留所有权利"
 *   inspirationalSlogan="构建美好的数字体验"
 *   products={[
 *     { name: "产品A", href: "/products/a" },
 *     { name: "产品B", href: "/products/b" }
 *   ]}
 * />
 * ```
 * 
 * 完整示例：
 * ```astro
 * <Footer 
 *   siteName="我的网站"
 *   homeLink="/"
 *   slogan="简单而强大"
 *   company="我的公司"
 *   copyright="保留所有权利"
 *   inspirationalSlogan="构建美好的数字体验"
 *   logo={{ src: "/logo.png", alt: "网站Logo" }}
 *   products={[
 *     { name: "产品A", href: "/products/a" },
 *     { name: "产品B", href: "/products/b" }
 *   ]}
 *   socialLinks={[
 *     "https://github.com/myusername",
 *     "https://twitter.com/myusername"
 *   ]}
 *   aboutLink="/about"
 *   contactLink="/contact"
 *   termsLink="/terms"
 *   privacyLink="/privacy"
 * />
 * ```
 * 
 * 指定语言：
 * ```astro
 * <Footer 
 *   siteName="My Website"
 *   homeLink="/"
 *   slogan="Simple and Powerful"
 *   company="My Company"
 *   copyright="All Rights Reserved"
 *   lang="en"
 * />
 * ```
 * 
 * 启用日志：
 * ```astro
 * <Footer 
 *   siteName="我的网站"
 *   homeLink="/"
 *   enableLogging={true}
 * />
 * ```
 * 
 * @props
 * @prop {string} siteName - 网站名称
 * @prop {string} homeLink - 首页链接
 * @prop {string} slogan - 网站标语
 * @prop {string} company - 公司名称
 * @prop {string} copyright - 版权信息
 * @prop {string} inspirationalSlogan - 鼓舞人心的标语，显示在横幅中
 * @prop {string} [icp] - ICP备案号（中国网站需要）
 * @prop {Object} [logo] - 网站Logo对象，包含src和alt属性
 * @prop {Array<Object>} [products=[]] - 产品链接数组，每个对象包含name、href和可选的external属性
 * @prop {string} [aboutLink] - "关于我们"页面链接
 * @prop {string} [contactLink] - "联系我们"页面链接
 * @prop {string} [termsLink] - "服务条款"页面链接
 * @prop {string} [privacyLink] - "隐私政策"页面链接
 * @prop {Array<string>} [socialLinks=[]] - 社交媒体链接数组
 * @prop {string} [teamLink] - "团队介绍"页面链接
 * @prop {string} [careersLink] - "加入我们"页面链接
 * @prop {string} [newsLink] - "新闻动态"页面链接
 * @prop {string} [historyLink] - "发展历程"页面链接
 * @prop {string} [partnersLink] - "合作伙伴"页面链接
 * @prop {string} [blogLink] - "技术博客"页面链接
 * @prop {string} [faqLink] - "常见问题"页面链接
 * @prop {string} [mediaLink] - "媒体报道"页面链接
 * @prop {string} [techStackLink] - "技术栈"页面链接
 * @prop {boolean} [debug=false] - 调试模式
 * @prop {string} [lang] - 语言代码，默认自动检测
 * @prop {boolean} [enableLogging=false] - 是否启用日志输出
 * 
 * @accessibility
 * - 使用语义化HTML结构，确保屏幕阅读器可以正确解析
 * - 所有链接都有明确的文本描述
 * - 社交媒体图标包含屏幕阅读器专用的文本说明
 */

import { processSocialLink } from '../../utils/social';
import Link from '../base/Link.astro';
import SocialIcon from '../icons/SocialIcon.astro';
import type { FooterProps } from '../../types/footer';
import { getCurrentLanguage, LanguageSource } from '../../utils/language';
import { createTextGetter } from '../../utils/i18n';

// 导入样式
import '../../app.css';

interface Props extends FooterProps {
	/**
	 * 语言代码
	 * @default 自动检测
	 */
	lang?: string;
	/**
	 * 是否启用日志输出
	 * @default false
	 */
	enableLogging?: boolean;
}

const {
	siteName,
	homeLink,
	slogan,
	company,
	copyright,
	inspirationalSlogan,
	icp,
	logo,
	products = [],
	aboutLink,
	contactLink,
	termsLink,
	privacyLink,
	socialLinks = [],
	teamLink,
	careersLink,
	newsLink,
	historyLink,
	partnersLink,
	blogLink,
	faqLink,
	mediaLink,
	techStackLink,
	debug = false,
	lang: userLang,
	enableLogging = false,
}: Props = Astro.props;

// 获取当前语言
const langInfo = getCurrentLanguage(userLang);
// 创建文本获取函数
const t = createTextGetter(langInfo, 'footer');

// 获取语言来源的描述
function getLanguageSourceDescription(source: LanguageSource): string {
  switch (source) {
    case LanguageSource.USER:
      return '用户指定';
    case LanguageSource.URL:
      return 'URL参数';
    case LanguageSource.BROWSER:
      return '浏览器设置';
    case LanguageSource.DEFAULT:
      return '默认语言';
    default:
      return '未知来源';
  }
}

const currentYear = new Date().getFullYear();

// 处理社交链接
const processedSocialLinks = socialLinks.map((url) => processSocialLink(url));

// 调试模式的样式类
const debugClasses = debug ? {
	footer: "border-2 border-blue-500",
	section: "border-2 border-green-500",
	nav: "border-2 border-yellow-500",
	aside: "border-2 border-purple-500"
} : {
	footer: "",
	section: "",
	nav: "",
	aside: ""
};
---

<footer class:list={["footer sm:footer-horizontal bg-base-200 text-base-content p-10", debugClasses.footer]}>
	<div class:list={["flex flex-col gap-8 container mx-auto items-center w-full md:flex-row md:justify-between", debugClasses.section]}>
		{/* 品牌区域 */}
		<aside class:list={["max-w-xs", debugClasses.aside]}>
			<a href={homeLink} class="flex items-center gap-2 mb-4">
				{logo && (
					<img
						src={logo.src}
						alt={logo.alt}
						class="mask mask-squircle w-12 h-12"
						width="48"
						height="48"
					/>
				)}
				<div>
					<h2 class="text-xl font-bold">{siteName}</h2>
					<p class="text-base-content/70">{slogan}</p>
				</div>
			</a>
			
			{/* 社交媒体链接 */}
			{processedSocialLinks.length > 0 && (
				<div class="flex gap-2 mt-4">
					{processedSocialLinks.map((link) => (
						<a 
							href={link.url} 
							class="btn btn-circle btn-ghost btn-sm"
							target="_blank" 
							rel="noopener noreferrer"
							aria-label={link.name}
						>
							<SocialIcon platform={link.platform} />
						</a>
					))}
				</div>
			)}
		</aside>

		{/* 导航区域 */}
		<div class:list={["flex flex-col gap-8 mx-auto max-w-xl text-center items-center w-full md:flex-row md:justify-between md:items-start", debugClasses.section]}>
			{/* 产品导航 */}
			{products.length > 0 && (
				<nav class:list={["flex flex-col gap-3 h-full", debugClasses.nav]}>
					<h6 class="footer-title">{t('products')}</h6>
					{products.map((product) => (
						<Link href={product.href} external={product.external} size='sm' block animation='hover-lift'>
							{product.name}
						</Link>
					))}
				</nav>
			)}

			{/* 关于导航 */}
			{(aboutLink || contactLink || teamLink || careersLink) && (
				<nav class:list={["flex flex-col gap-3 h-full", debugClasses.nav]}>
					<h6 class="footer-title">{t('about')}</h6>
					{aboutLink && <Link href={aboutLink} block animation='hover-lift' size='sm'>{t('aboutUs')}</Link>}
					{teamLink && <Link href={teamLink} block animation='hover-lift' size='sm'>{t('team')}</Link>}
					{careersLink && <Link href={careersLink} block animation='hover-lift' size='sm'>{t('careers')}</Link>}
					{contactLink && <Link href={contactLink} block animation='hover-lift' size='sm'>{t('contactUs')}</Link>}
				</nav>
			)}

			{/* 资源导航 */}
			{(newsLink || historyLink || partnersLink || blogLink || faqLink || mediaLink || techStackLink) && (
				<nav class:list={["flex flex-col gap-3", debugClasses.nav]}>
					<h6 class="footer-title">{t('resources')}</h6>
					{newsLink && <Link href={newsLink} block animation='hover-lift' size='sm'>{t('news')}</Link>}
					{blogLink && <Link href={blogLink} block animation='hover-lift' size='sm'>{t('blog')}</Link>}
					{faqLink && <Link href={faqLink} block animation='hover-lift' size='sm'>{t('faq')}</Link>}
					{historyLink && <Link href={historyLink} block animation='hover-lift' size='sm'>{t('history')}</Link>}
					{techStackLink && <Link href={techStackLink} block animation='hover-lift' size='sm'>{t('techStack')}</Link>}
				</nav>
			)}

			{/* 法律导航 */}
			{(termsLink || privacyLink) && (
				<nav class:list={["flex flex-col gap-3", debugClasses.nav]}>
					<h6 class="footer-title">{t('legal')}</h6>
					{termsLink && <Link href={termsLink} block animation='hover-lift' size='sm'>{t('terms')}</Link>}
					{privacyLink && <Link href={privacyLink} block animation='hover-lift' size='sm'>{t('privacy')}</Link>}
				</nav>
			)}
		</div>
	</div>
</footer>

{/* 横幅 */}
{inspirationalSlogan && (
	<aside class:list={["p-4 bg-primary text-primary-content w-full", debugClasses.aside]}>
		<p class="text-center">{inspirationalSlogan}</p>
	</aside>
)}

{/* 底部版权信息 */}
<div class:list={["footer footer-center p-4 bg-base-300 text-base-content", debugClasses.footer]}>
	<aside class:list={["items-center grid-flow-col", debugClasses.aside]}>
		<p class="text-sm opacity-70">
			© {currentYear} {company} - {copyright || t('allRightsReserved')}
		</p>
		{icp && (
			<p class="text-sm opacity-70 ml-4">
				{icp}
			</p>
		)}
	</aside>
</div>

<script define:vars={{ langInfo, enableLogging }}>
  // 输出语言信息到控制台
  if (enableLogging) {
    console.log(`[Footer] 语言信息:`, {
      语言代码: langInfo.code,
      语言来源: langInfo.source,
      来源描述: (() => {
        switch (langInfo.source) {
          case 'user': return '用户指定';
          case 'url': return 'URL参数';
          case 'browser': return '浏览器设置';
          case 'default': return '默认语言';
          default: return '未知来源';
        }
      })()
    });
  }
</script>