---
/**
 * Sidebar组件
 * 
 * 用于文档页面的侧边栏导航
 * 
 * @example
 * ```astro
 * ---
 * import Sidebar from './Sidebar.astro';
 * 
 * const sidebarItems = [
 *   { title: "入门", items: [
 *     { href: "/docs/getting-started", text: "快速开始" },
 *     { href: "/docs/installation", text: "安装" }
 *   ]}
 * ];
 * ---
 * 
 * <Sidebar sidebarItems={sidebarItems} currentPath="/docs/getting-started" />
 * ```
 */

import { isPathMatch } from '../../utils/path';
import "../../app.css"

export interface SidebarItem {
  href: string;
  text: string;
  items?: SidebarItem[];
}

export interface SidebarSection {
  title: string;
  items: SidebarItem[];
}

export interface Props {
  /**
   * 侧边栏项目
   */
  sidebarItems: SidebarSection[];
  
  /**
   * 当前路径
   */
  currentPath: string;

  /**
   * 桌面端类名
   */
  class?: string;

  /**
   * 是否开启调试模式，显示边框
   * @default false
   */
  debug?: boolean;
}

const { 
  sidebarItems, 
  currentPath, 
  class: className,
  debug = false
} = Astro.props;

const debugClass = debug ? "cosy:border cosy:border-red-500" : "";
---

<aside class:list={[className, debugClass]}>
  <div class="cosy:top-16 cosy:sticky cosy:h-[calc(100vh-4rem)]">
    <nav class:list={["cosy:p-4", debugClass]}>
      {sidebarItems.map((section: SidebarSection) => (
        <div class:list={["cosy:mb-6", debugClass]}>
          <h3 class:list={["cosy:font-bold cosy:mb-2 cosy:text-base-content/70", debugClass]}>{section.title}</h3>
          <ul class:list={["cosy:menu cosy:bg-base-200 cosy:rounded-box cosy:w-56", debugClass]}>
            {section.items.map((item: SidebarItem) => {
              const isActive = isPathMatch(currentPath, item.href);
              return (
                <li class:list={[debugClass]}>
                  <a 
                    href={item.href} 
                    class:list={[
                      "cosy:hover:bg-base-300",
                      { "cosy:menu-active": isActive },
                      debugClass
                    ]}
                  >
                    {item.text}
                  </a>
                  {item.items && (
                    <ul class:list={[debugClass]}>
                      {item.items.map((subitem: SidebarItem) => {
                        const isSubActive = isPathMatch(currentPath, subitem.href);
                        return (
                          <li class:list={[debugClass]}>
                            <a 
                              href={subitem.href} 
                              class:list={[
                                "cosy:hover:bg-base-300",
                                { "cosy:active": isSubActive },
                                debugClass
                              ]}
                            >
                              {subitem.text}
                            </a>
                            {subitem.items && (
                              <ul class:list={[debugClass]}>
                                {subitem.items.map((subsubitem: SidebarItem) => {
                                  const isSubSubActive = isPathMatch(currentPath, subsubitem.href);
                                  return (
                                    <li class:list={[debugClass]}>
                                      <a 
                                        href={subsubitem.href} 
                                        class:list={[
                                          "cosy:hover:bg-base-300",
                                          { "cosy:active": isSubSubActive },
                                          debugClass
                                        ]}
                                      >
                                        {subsubitem.text}
                                      </a>
                                    </li>
                                  );
                                })}
                              </ul>
                            )}
                          </li>
                        );
                      })}
                    </ul>
                  )}
                </li>
              );
            })}
          </ul>
        </div>
      ))}
    </nav>
  </div>
</aside>