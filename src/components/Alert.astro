---
/**
 * @component Alert
 * 
 * @description
 * Alert 组件用于向用户显示重要的提示信息，支持多种类型的提示样式和交互效果。
 * 
 * @design
 * 设计理念：
 * 1. 简洁明了 - 使用清晰的视觉层次和颜色编码传达信息的重要性和类型
 * 2. 响应式交互 - 提供丰富的动画和交互反馈，增强用户体验
 * 3. 可定制性 - 支持多种配置选项，适应不同场景需求
 * 4. 无障碍性 - 遵循 WAI-ARIA 实践，确保所有用户都能获得良好体验
 * 
 * 视觉特点：
 * - 入场/退出动画：平滑的滑入/滑出效果
 * - 悬停效果：轻微上浮和阴影增强
 * - 图标动画：悬停时轻微放大
 * - 左侧彩色边框：直观区分不同类型的提示
 * - 进度条：自动关闭时的视觉倒计时
 * 
 * @usage
 * 基本用法：
 * ```astro
 * <Alert type="info">这是一条信息提示</Alert>
 * ```
 * 
 * 带标题：
 * ```astro
 * <Alert type="success" title="操作成功">您的操作已成功完成</Alert>
 * ```
 * 
 * 可关闭的提示：
 * ```astro
 * <Alert type="warning" closeable={true}>请注意这个警告信息</Alert>
 * ```
 * 
 * 自动关闭：
 * ```astro
 * <Alert type="success" autoClose={5000}>5秒后自动关闭</Alert>
 * ```
 * 
 * 组合使用：
 * ```astro
 * <Alert 
 *   type="error" 
 *   title="提交失败" 
 *   closeable={true} 
 *   autoClose={10000}
 *   class="my-custom-class"
 * >
 *   请检查表单并重新提交
 * </Alert>
 * ```
 * 
 * @props
 * @prop {('info'|'success'|'warning'|'error')} [type='info'] - 提示类型，影响颜色和图标
 * @prop {string} [title] - 提示标题，可选
 * @prop {boolean} [closeable=false] - 是否显示关闭按钮
 * @prop {string} [class] - 自定义 CSS 类名
 * @prop {number} [autoClose] - 自动关闭的时间（毫秒），不设置则不自动关闭
 * 
 * @slots
 * @slot default - 提示内容
 * 
 * @cssVariables
 * 组件内部使用的 CSS 变量：
 * --auto-close-duration: 进度条动画持续时间，自动设置为 autoClose 属性值
 * 
 * @accessibility
 * - 使用适当的 ARIA 角色（role="alert"）
 * - 关闭按钮带有描述性 aria-label
 * - 动画遵循 prefers-reduced-motion 媒体查询（待实现）
 * 
 * @dependencies
 * 依赖于以下图标组件：
 * - InfoIcon, SuccessIcon, WarningIcon, ErrorIcon, CloseIcon
 */

import { InfoIcon, SuccessIcon, WarningIcon, ErrorIcon, CloseIcon } from '../icons';

interface Props {
  type?: 'info' | 'success' | 'warning' | 'error';
  title?: string;
  closeable?: boolean;
  class?: string;
  autoClose?: number; // 自动关闭的时间（毫秒），如果不设置则不自动关闭
}

const {
  type = 'info',
  title,
  closeable = false,
  class: className = '',
  autoClose,
} = Astro.props;

// 根据类型设置样式
const alertClass = {
  info: 'alert-info',
  success: 'alert-success',
  warning: 'alert-warning',
  error: 'alert-error',
}[type];

// 根据类型设置图标组件
const IconComponent = {
  info: InfoIcon,
  success: SuccessIcon,
  warning: WarningIcon,
  error: ErrorIcon,
}[type];
---

<div class={`alert ${alertClass} ${className}`} role="alert" data-auto-close={autoClose}>
  <div class="alert-content">
    <div class="alert-icon">
      <IconComponent />
    </div>
    <div class="alert-body">
      {title && <h3 class="alert-title">{title}</h3>}
      <div class="alert-message"><slot /></div>
    </div>
    {closeable && (
      <button class="alert-close-btn" aria-label="关闭提示">
        <CloseIcon />
      </button>
    )}
  </div>
  {autoClose && <div class="alert-progress"></div>}
</div>

<style>
  /* 
   * 基本样式
   * 提供基础的外观和布局
   */
  .alert {
    padding: 1rem;
    border-radius: 0.375rem;
    margin-bottom: 1rem;
    position: relative;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    animation: slideIn 0.3s ease-out;
  }

  /* 
   * 入场动画
   * 从上方滑入并淡入显示
   */
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* 
   * 退出动画
   * 向上滑出并淡出，同时缩小高度
   */
  .alert.closing {
    animation: slideOut 0.3s ease-in forwards;
  }

  @keyframes slideOut {
    from {
      opacity: 1;
      transform: translateY(0);
      max-height: 200px;
    }
    to {
      opacity: 0;
      transform: translateY(-10px);
      max-height: 0;
      margin: 0;
      padding: 0;
    }
  }

  /* 
   * 悬停效果
   * 轻微上浮并增加阴影
   */
  .alert:hover {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
  }

  /* 
   * 内容布局
   * 使用 flex 布局排列图标、文本和关闭按钮
   */
  .alert-content {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  /* 
   * 图标样式和动画
   * 悬停时轻微放大
   */
  .alert-icon {
    flex-shrink: 0;
    transform: scale(1);
    transition: transform 0.2s ease;
  }

  .alert:hover .alert-icon {
    transform: scale(1.1);
  }

  /* 
   * 文本区域
   * 占据剩余空间
   */
  .alert-body {
    flex: 1;
  }

  /* 
   * 标题样式
   */
  .alert-title {
    font-weight: bold;
    margin-top: 0;
    margin-bottom: 0.25rem;
  }

  /* 
   * 消息内容
   */
  .alert-message {
    margin: 0;
  }

  /* 
   * 关闭按钮样式和动画
   * 悬停时旋转并增加不透明度
   */
  .alert-close-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    padding: 0;
    transition: all 0.2s ease;
    opacity: 0.7;
  }

  .alert-close-btn:hover {
    background-color: rgba(0, 0, 0, 0.1);
    transform: rotate(90deg);
    opacity: 1;
  }

  /* 
   * 进度条动画
   * 用于自动关闭的视觉倒计时
   */
  .alert-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    background-color: rgba(255, 255, 255, 0.7);
    width: 100%;
    transform-origin: left;
    animation: progress-shrink var(--auto-close-duration, 3000ms) linear forwards;
  }

  @keyframes progress-shrink {
    from {
      transform: scaleX(1);
    }
    to {
      transform: scaleX(0);
    }
  }

  /* 
   * 类型样式
   * 为不同类型的提示设置不同的颜色方案
   */
  .alert-info {
    background-color: #e0f2fe;
    border-left: 4px solid #3b82f6;
    color: #0369a1;
  }

  .alert-success {
    background-color: #dcfce7;
    border-left: 4px solid #22c55e;
    color: #166534;
  }

  .alert-warning {
    background-color: #fef9c3;
    border-left: 4px solid #eab308;
    color: #854d0e;
  }

  .alert-error {
    background-color: #fee2e2;
    border-left: 4px solid #ef4444;
    color: #b91c1c;
  }
</style>

<script define:vars={{ closeable, autoClose }}>
  /**
   * 初始化所有 Alert 组件
   * 设置关闭按钮事件和自动关闭功能
   */
  function initializeAlerts() {
    const alerts = document.querySelectorAll('.alert');
    
    alerts.forEach(alert => {
      // 设置关闭按钮
      if (closeable) {
        const closeBtn = alert.querySelector('.alert-close-btn');
        if (closeBtn) {
          closeBtn.addEventListener('click', () => closeAlert(alert));
        }
      }
      
      // 设置自动关闭
      const autoCloseTime = alert.dataset.autoClose;
      if (autoCloseTime) {
        // 设置进度条动画时间
        alert.style.setProperty('--auto-close-duration', `${autoCloseTime}ms`);
        
        // 设置定时器自动关闭
        setTimeout(() => {
          closeAlert(alert);
        }, parseInt(autoCloseTime));
      }
    });
  }
  
  /**
   * 关闭 Alert 的动画处理
   * @param {HTMLElement} alert - 要关闭的 Alert 元素
   */
  function closeAlert(alert) {
    // 添加关闭动画类
    alert.classList.add('closing');
    
    // 动画结束后移除元素
    setTimeout(() => {
      alert.remove();
    }, 300); // 与动画时长相匹配
  }

  // 初始化
  initializeAlerts();

  // Astro 页面切换时重新初始化
  document.addEventListener('astro:page-load', initializeAlerts);
</script> 
